#!/bin/bash
set -e

function dlogin() {
  login_cmd="$(aws ecr get-login --region eu-central-1 --no-include-email)"
  password="$(awk '{print $6};' <<< $login_cmd)"
  registry="$(awk '{print $7};' <<< $login_cmd)"
  docker login -u AWS --password-stdin $registry <<< $password
}

dlogin||logger "We failed to login to the docker registry"
